# الميزات الجديدة - نظام ERP المالي

## الصفحات المضافة

### 1. صفحة المالية (Finance)
**المسار:** `/finance`

**الوصف:** صفحة تفصيلية لعرض البيانات المالية حسب المراكز

**الميزات:**
- عرض تفصيل الرسوم حسب المراكز
- فلترة حسب الفترة الزمنية (من/إلى)
- عرض إحصائيات شاملة:
  - طابع الشهيد
  - المجهود الحربي
  - رسم الطابع
  - رسم الأعمار
  - الإدارة المحلية
  - البدل المقترح
- عرض حصة الدولة والاتحاد والشركات
- تصدير البيانات إلى CSV
- جدول تفصيلي يعرض:
  - اسم المركز
  - المحافظة
  - IP المركز
  - عدد الدفعات
  - المبالغ التفصيلية

**API Endpoint:**
```
GET /api/admin/finance/breakdown-by-center
Query Parameters:
  - from: تاريخ البداية (YYYY-MM-DD)
  - to: تاريخ النهاية (YYYY-MM-DD)
```

---

### 2. صفحة التوزيع المالي (Finance Distribution)
**المسار:** `/finance-distribution`

**الوصف:** صفحة توزيع المبالغ على شركات التأمين

**الميزات:**
- عرض توزيع المبالغ حسب شركة التأمين
- فلترة حسب الفترة الزمنية
- عرض إحصائيات إجمالية:
  - الإجمالي الكلي
  - عدد الدفعات
  - حصة الدولة
  - حصة الاتحاد
  - حصة الشركات
- تفصيل الرسوم لكل شركة:
  - طابع الشهيد
  - المجهود الحربي
  - رسم الطابع
  - رسم الأعمار
  - الإدارة المحلية
  - البدل المقترح
- تصدير البيانات إلى CSV
- جدول تفصيلي يعرض كل شركة مع مبالغها

**API Endpoint:**
```
GET /api/admin/finance/distribution-by-company
Query Parameters:
  - from: تاريخ البداية (YYYY-MM-DD)
  - to: تاريخ النهاية (YYYY-MM-DD)
```

---

### 3. صفحة التقارير (Reports)
**المسار:** `/reports`

**الوصف:** صفحة عرض وإدارة جميع التقارير المتاحة في النظام

**الميزات:**
- عرض شبكة من بطاقات التقارير
- تصنيف التقارير حسب الفئات:
  - **التوزيعات:** توزع العقود حسب الشهر/الفئة/الجنسية/الصانع/الشركة/الموظف
  - **المالية:** توزع الإيرادات، حصة الاتحاد، أوامر الدفع، البطاقة الإلكترونية
  - **العمليات:** الإحصاء العام، الاستعلام العام، تقارير الموظفين
  - **التصدير:** تصدير البيانات إلى Excel/CSV
- بحث في التقارير
- فلترة حسب الفئة
- عداد للتقارير المتاحة والمعروضة

**التقارير المتاحة:**
1. توزع عدد العقود على أشهر السنة
2. توزع العقود حسب الفئة
3. توزع العقود حسب جنسية المركبة
4. توزع العقود حسب الصانع
5. توزع العقود حسب الشركة المصدرة
6. توزع العقود حسب الموظف
7. توزع الإيرادات على الشركات
8. توزع الإيرادات على المراكز
9. حصة الاتحاد حسب الشركة
10. حصة الاتحاد حسب المراكز
11. تقرير أوامر الدفع حسب المحافظات
12. إيرادات البطاقة الإلكترونية
13. الإحصاء العام
14. الاستعلام العام
15. تقارير الموظفين
16. تصدير البيانات

**ملاحظة:** التقارير حالياً في وضع العرض فقط، وستتم إضافة وظائف التوليد والتصدير لاحقاً.

---

## مكونات UI الجديدة

تم إضافة المكونات التالية لدعم الصفحات الجديدة:

### 1. Select Component
**المسار:** `src/components/ui/select.tsx`

مكون قائمة منسدلة بسيط مع تصميم موحد.

### 2. Badge Component
**المسار:** `src/components/ui/badge.tsx`

مكون شارة لعرض المعلومات المختصرة مع أنماط متعددة:
- `default`: النمط الافتراضي (أساسي)
- `secondary`: نمط ثانوي
- `destructive`: نمط تحذيري
- `outline`: نمط محدد

### 3. Table Components
**المسار:** `src/components/ui/table.tsx`

مجموعة مكونات الجداول:
- `Table`: الجدول الرئيسي
- `TableHeader`: رأس الجدول
- `TableBody`: جسم الجدول
- `TableRow`: صف الجدول
- `TableHead`: خلية رأس الجدول
- `TableCell`: خلية الجدول

### 4. Separator Component
**المسار:** `src/components/ui/separator.tsx`

مكون فاصل أفقي لتقسيم المحتوى.

### 5. Alert Component
**المسار:** `src/components/ui/alert.tsx`

مكون تنبيه لعرض الرسائل:
- `Alert`: الحاوية الرئيسية
- `AlertDescription`: وصف التنبيه

---

## التحديثات على الصفحات الموجودة

### Dashboard (الصفحة الرئيسية)
تم تحديث أزرار التنقل في الهيدر لتشمل:
- دفتر اليومية
- المالية (جديد)
- التوزيع المالي (جديد)
- التقارير (جديد)
- خروج

---

## Routes المضافة

تم إضافة المسارات التالية في `App.tsx`:

```typescript
<Route path="/finance" element={<Protected><Finance /></Protected>} />
<Route path="/finance-distribution" element={<Protected><FinanceDistribution /></Protected>} />
<Route path="/reports" element={<Protected><Reports /></Protected>} />
```

---

## Backend API Endpoints

تم إضافة/تحديث الـ endpoints التالية في `newback_sigurta`:

### 1. Finance Breakdown by Center
```
GET /api/admin/finance/breakdown-by-center
```
**المعاملات:**
- `from`: تاريخ البداية (YYYY-MM-DD)
- `to`: تاريخ النهاية (YYYY-MM-DD)

**الاستجابة:**
```json
{
  "success": true,
  "from": "2024-01-01",
  "to": "2024-12-31",
  "data": [
    {
      "centerId": "...",
      "centerName": "...",
      "centerCode": "...",
      "centerIp": "...",
      "province": "...",
      "paymentsCount": 100,
      "totalAmount": 1000000,
      "martyrTotal": 50000,
      "warTotal": 30000,
      "stampTotal": 20000,
      "agesTotal": 15000,
      "localTotal": 10000,
      "proposedTotal": 5000,
      "stateShareTotal": 130000,
      "federationTotal": 50000,
      "companyShareTotal": 820000
    }
  ],
  "grand": {
    "grandTotal": 1000000,
    "grandCount": 100,
    "martyrTotal": 50000,
    ...
  }
}
```

### 2. Finance Distribution by Company
```
GET /api/admin/finance/distribution-by-company
```
**المعاملات:**
- `from`: تاريخ البداية (YYYY-MM-DD)
- `to`: تاريخ النهاية (YYYY-MM-DD)

**الاستجابة:**
```json
{
  "success": true,
  "from": "2024-01-01",
  "to": "2024-12-31",
  "data": [
    {
      "insuranceCompanyId": "...",
      "insuranceCompanyName": "...",
      "paymentsCount": 50,
      "totalAmount": 500000,
      "stateShareTotal": 65000,
      "federationTotal": 25000,
      "companyShareTotal": 410000,
      "martyrTotal": 25000,
      "warTotal": 15000,
      "stampTotal": 10000,
      "agesTotal": 7500,
      "localTotal": 5000,
      "proposedTotal": 2500
    }
  ],
  "grand": {
    "grandTotal": 500000,
    "grandCount": 50,
    "stateShareTotal": 65000,
    ...
  }
}
```

---

## التصميم والألوان

تم الحفاظ على نفس نظام الألوان من `newAdmin_sigurta`:
- **اللون الأساسي:** بنفسجي داكن `rgb(126, 34, 206)`
- **الخلفية:** تدرج بنفسجي فاتح
- **الحدود:** بنفسجي فاتح `rgb(206, 176, 221)`
- **الأزرار:** متناسقة مع النظام الموحد

---

## كيفية الاستخدام

### 1. الوصول إلى الصفحات
بعد تسجيل الدخول:
1. من الصفحة الرئيسية، انقر على الأزرار في الهيدر
2. أو استخدم المسارات المباشرة:
   - `/finance` للمالية
   - `/finance-distribution` للتوزيع المالي
   - `/reports` للتقارير

### 2. استخدام الفلاتر
1. اختر تاريخ البداية والنهاية
2. انقر على "تحديث" لتحميل البيانات
3. استخدم "تصدير CSV" لتنزيل البيانات

### 3. التنقل
- استخدم زر "الرئيسية" للعودة إلى Dashboard
- استخدم زر "خروج" لتسجيل الخروج

---

## المتطلبات

### Frontend (sigurta-finance-erp)
- React 18+
- React Router DOM
- Axios
- Tailwind CSS

### Backend (newback_sigurta)
- Node.js
- Express
- MongoDB/Mongoose
- JWT Authentication

---

## الملاحظات

1. **الأمان:** جميع الصفحات محمية بـ JWT authentication
2. **الأداء:** يتم تحميل البيانات عند الطلب فقط
3. **التوافق:** الـ API endpoints متوافقة مع `newAdmin_sigurta`
4. **التوسع:** يمكن إضافة المزيد من التقارير بسهولة في صفحة Reports

---

## التطوير المستقبلي

- [ ] إضافة رسوم بيانية للبيانات المالية
- [ ] تفعيل توليد التقارير في صفحة Reports
- [ ] إضافة تصدير PDF للتقارير
- [ ] إضافة فلاتر متقدمة (حسب المركز، الشركة، إلخ)
- [ ] إضافة صفحة تفاصيل لكل تقرير
- [ ] دعم الطباعة المباشرة

---

تم إنشاء هذا الملف في: 2026-01-18
